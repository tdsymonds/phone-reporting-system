{% extends 'phone/pages/_base.html' %}
{% load sekizai_tags widget_tweaks staticfiles %}

{% block title %}Welcome {{ request.user.first_name }} to your phone reporting dashboard{% endblock %}

{% block content %}
    <div id="page-content-wrapper">
        <section class="header-bar">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xs-10">
                        <a href="#menu-toggle" class="btn btn-blue toggle-menu" id="menu-toggle"><i class="fa fa-bars"></i>  </a>
                        <h1 class="welcome-msg">Welcome {{ request.user.first_name }}</h1>
                    </div>
                    <div class="col-xs-2">
                        <a class="btn btn-blue logout" href="{% url 'logout' %}"><i class="fa fa-sign-out"></i>Logout</a>
                    </div>
                </div>
            </div>
        </section>

        <section class="filter-bar">
            <form id="filter-bar-form">
                <div class="row">
                    <div class="col-xs-12 col-md-4">
                        {% include 'phone/reusable/_datepicker.html' %}
                    </div>
                </div>
            </form>
        </section>

        <section class="chart-section">
            <div class="container-fluid">
                <div class="row">
                    {% for chart in charts %}
                        <div class="col-xs-12 col-md-6">
                            <div id="chart-{{ chart.pk }}" class="chart"></div>
                        </div>
                        {% if forloop.counter|divisibleby:"2" and not forloop.last %}
                            </div><div class="row">
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </section>

    </div>

    

    {% addtoblock "js" %}
        <script src="{% static 'phone/js/mycharts.js' %}"></script>
        <script type="text/javascript">
            function setCharts(){
                var form = $('#filter-bar-form');
                var qs = '?' + form.serialize();

                {% for chart in charts %}
                    $('#chart-{{ chart.pk}}').mycharts('{{ chart.chart_type }}', {
                        title: '{{ chart.title }}',
                        url: '{{ chart.get_url }}' + qs + '{{ chart.query_string|default_if_none:"" }}'
                    });
                {% endfor %}                
            }

            $(function(){
                $('#filter-bar-form').change(function () {
                    // the datepicker is changing the form 
                    // on load, so no need to call initially
                    setCharts();
                });

            })

        </script>
    {% endaddtoblock %} 

{% endblock %}